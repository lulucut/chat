"use strict";function formatDate(){var t=new Date;return t.getFullYear()+"/"+t.getMonth()+"/"+t.getDate()+"  "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()}var img=new Image,Chat=function(){function t(){this.socket=null,this.init()}function n(t){g.text(t.size),t.flag?p('<div class="user-in">\n\t\t\t\t欢迎\n\t\t\t\t<img class="user-img" src="images/face.jpeg" />\n\t\t\t\t<strong class="user-name">'+t.nickname+"</strong> \n\t\t\t\t加入群聊！\n\t\t\t</div>"):s("system","用户 "+t.nickname+" 已经离开群聊")}function e(t,n,e){e=e?"me-":"";var s='<div class="'+e+'chat-info">\n\t\t\t<img class="user-normal-img" src="images/face.jpeg" />\n\t\t\t<span class="time">\n\t\t\t\t<strong class="user-name">'+t+"</strong> \n\t\t\t\t"+formatDate()+'\n\t\t\t</span>\n\t\t\t<span class="'+e+'message">\n\t\t\t\t'+n+"\n\t\t\t</span>\n\t\t</div>";p(s)}function s(t,n){e(t,n,!1)}function i(t){e("我",t,!0)}function c(){m=L(".info"),g=L("#peopel"),f=L(".msg"),d=L("#nickname"),h=L("#users"),k=L(".current"),o(),p=r(f),this.initSend()}function o(){h.click(function(t){for(var n=t.target;"LI"!==n.tagName;)n=n.parentNode;k.get(0)!==n&&(k.removeClass("current"),k=L(n),k.addClass("current"))})}function a(t){return l.innerHTML=t,l.childNodes[0]}function r(t){var n=t.get(0);return function(t){n.appendChild(a(t)),n.scrollTop=n.scrollHeight}}var u=t.prototype,l=document.createElement("div"),m=null,g=null,f=null,d=null,p=null,h=null,k=null,v=!1;return u.init=function(){var t=this;this.socket=io.connect(),this.socket.on("connect",function(){L(".loading").css({display:"none"}),L(".enter-name").css({display:"block"}),c.call(t),t.system(),t.newmsg()})},u.login=function(){var t=this;L("#send-name").click(function(){var n=d.val();n.trim()?t.socket.emit("login",n):m.text("your nickname can't be blank or just spaces")}),this.socket.on("loginSuccess",function(){v=!0,L("#mask").css({display:"none"})}),this.socket.on("repeat",function(){m.text("your nickname is token, please use another")})},u.system=function(){this.socket.on("system",function(t){v&&n(t)})},u.newmsg=function(){this.socket.on("newmsg",function(t,n){s(t,n)})},u.initSend=function(){var t=this;L("#send").click(function(){var n=L("#msg-input"),e=n.val();e.trim()&&(n.val(""),i(e),t.socket.emit("postmsg",e)),n.get(0).focus()})},t}();L(window).load(function(){new Chat,img.src="images/face.jpeg",img.onerror=function(){this.src="images/logo.png"}});