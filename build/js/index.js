"use strict";function formatDate(){var t=new Date;return t.getFullYear()+"/"+t.getMonth()+"/"+t.getDate()+"  "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()}var img=new Image,Chat=function(){function t(){this.socket=null,this.init()}function n(t){l.text(t.size),t.flag?r.get(0).appendChild(i('<div class="user-in">\n\t\t\t\t欢迎\n\t\t\t\t<img class="user-img" src="images/face.jpeg" />\n\t\t\t\t<strong class="user-name">'+t.nickname+"</strong> \n\t\t\t\t加入群聊！\n\t\t\t</div>")):e("system","用户 "+t.nickname+" 已经离开群聊")}function e(t,n){var e='<div class="chat-info">\n\t\t\t<img class="user-normal-img" src="images/face.jpeg" />\n\t\t\t<span class="time">\n\t\t\t\t<strong class="user-name">'+t+"</strong>\n\t\t\t\t"+formatDate()+'\n\t\t\t</span>\n\t\t\t<span class="message">\n\t\t\t\t'+n+"\n\t\t\t</span>\n\t\t</div>";r.get(0).appendChild(i(e))}function s(){a=L(".info"),l=L("#peopel"),r=L(".msg"),u=L("#nickname"),u.get(0).focus(),this.initSend()}function i(t){return c.innerHTML=t,c.childNodes[0]}var o=t.prototype,c=document.createElement("div"),a=null,l=null,r=null,u=null,g=!1;return o.init=function(){var t=this;this.socket=io.connect(),this.socket.on("connect",function(){L(".loading").css({display:"none"}),L(".enter-name").css({display:"block"}),s.call(t),t.login(),t.system(),t.newmsg()})},o.login=function(){var t=this;L("#send-name").click(function(){var n=u.val();n.trim()?t.socket.emit("login",n):a.text("your nickname can't be blank or just spaces")}),this.socket.on("loginSuccess",function(){g=!0,L("#mask").css({display:"none"})}),this.socket.on("repeat",function(){a.text("your nickname is token, please use another")})},o.system=function(){this.socket.on("system",function(t){g&&n(t)})},o.newmsg=function(){this.socket.on("newmsg",function(t,n){e(t,n)})},o.initSend=function(){var t=this;L("#send").click(function(){var n=L("#msg-input"),e=n.val();e.trim()&&(n.val(""),t.socket.emit("postmsg",e)),r.get(0).appendChild(i("<div>"+e+"</div>")),n.get(0).focus()})},t}();L(window).load(function(){new Chat,img.src="images/face.jpeg",img.onerror=function(){this.src="images/logo.png"}});