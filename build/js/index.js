"use strict";var img=new Image,Chat=function(){function t(){this.socket=null,this.init()}function n(t){f.text(t.size),t.flag?v('<div class="user-in">\n\t\t\t\t欢迎\n\t\t\t\t<img class="user-img" src="images/face.jpeg" />\n\t\t\t\t<strong class="user-name">'+t.nickname+"</strong> \n\t\t\t\t加入群聊！\n\t\t\t</div>"):s("system","用户 "+t.nickname+" 已经离开群聊")}function e(t,n,e){e=e?"me-":"";var s='<div class="'+e+'chat-info">\n\t\t\t<img class="user-normal-img" src="images/face.jpeg" />\n\t\t\t<span class="time">\n\t\t\t\t<strong class="user-name">'+t+"</strong> \n\t\t\t\t"+g()+'\n\t\t\t</span>\n\t\t\t<span class="'+e+'message">\n\t\t\t\t'+n+"\n\t\t\t</span>\n\t\t</div>";v(s)}function s(t,n){e(t,n,!1)}function i(t){e("我",t,!0)}function o(){var t=L(".active"),n=L(".show");m=L(".info"),f=L("#peopel"),d=L("#msg-area").get(0),h=L("#nickname"),p=L("#users"),k.group={user:t,ele:n},n.show(),Object.defineProperty(C,"ele",{get:function(){return t},set:function(e){var s=e.data("id");if(t.removeClass("active"),e.addClass("active"),n.removeClass("show"),k[s])n=k[s].ele,n.addClass("show");else{var i=c(s);d.appendChild(i),n=L(i),k[s]={user:e,ele:n}}t=e}}),h.get(0).focus(),a(),v=u(k.group.ele),this.initSend()}function c(t){return r('<div class="msg show" data-id='+t+"></div>")}function a(){p.click(function(t){for(var n=t.target;"LI"!==n.tagName;)n=n.parentNode;C.ele=L(n)})}function r(t){return y.innerHTML=t,y.childNodes[0]}function u(t){var n=t.get(0);return function(t){n.appendChild(r(t)),n.scrollTop=n.scrollHeight}}function g(){var t=new Date;return t.getFullYear()+"/"+t.getMonth()+"/"+t.getDate()+"  "+t.getHours()+":"+l(t.getMinutes())+":"+l(t.getSeconds())}function l(t){return String(t).length<2?"0"+t:t}var m,f,d,h,v,p,k={},w=t.prototype,y=document.createElement("div"),C={},j=!1;return w.init=function(){var t=this;this.socket=io.connect(),this.socket.on("connect",function(){L(".loading").hide(),L(".enter-name").show(),o.call(t),t.login(),t.system(),t.newmsg()})},w.login=function(){var t=this;L("#send-name").click(function(){var n=h.val();n.trim()?t.socket.emit("login",n):m.text("your nickname can't be blank or just spaces")}),this.socket.on("loginSuccess",function(){j=!0,L("#mask").hide()}),this.socket.on("repeat",function(){m.text("your nickname is token, please use another")})},w.system=function(){this.socket.on("system",function(t){j&&n(t)})},w.newmsg=function(){this.socket.on("newmsg",function(t,n){s(t,n)})},w.initSend=function(){var t=this;L("#send").click(function(){var n=L("#msg-input"),e=n.val();e.trim()&&(n.val(""),i(e),t.socket.emit("postmsg",e)),n.get(0).focus()})},t}();L(window).load(function(){new Chat,img.src="images/face.jpeg",img.onerror=function(){this.src="images/logo.png"}});